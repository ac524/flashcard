<div class="row row-flex row-cards" id="flashcards">
    <div class="col s12 l6">
        <form class="h-100">
            <fieldset class="h-100" disabled>
                <div class="card card-flash hoverable saving">
                    <div class="card-content blue white-text lighten-1">
                        <textarea type="text" class="flash-question white-text" name="question">What's my favorite color?</textarea>
                    </div>
                    <div class="card-content blue lighten-5">
                        <textarea type="text" class="flash-answer"  name="answer">green</textarea>
                    </div>
                    <div class="card-action">
                        <button class="btn z-depth-0"><i class="material-icons left">save</i>Save</button>
                    </div>
                    <div class="progress m-0">
                        <div class="indeterminate"></div>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col s12 l6">
        <form class="h-100">
            <fieldset class="h-100">
                <div class="card card-flash hoverable">
                    <div class="card-content blue white-text lighten-1">
                        <textarea type="text" class="flash-question white-text" name="question">What's my favorite color?</textarea>
                    </div>
                    <div class="card-content blue lighten-5">
                        <textarea type="text" class="flash-answer"  name="answer">green</textarea>
                    </div>
                    <div class="card-action">
                        <button class="btn z-depth-0"><i class="material-icons left">save</i>Save</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col s12 l6">
        <form class="h-100">
            <fieldset class="h-100">
                <div class="card card-flash hoverable">
                    <div class="card-content blue white-text lighten-1">
                        <textarea type="text" class="flash-question white-text" name="question">What's my favorite color?</textarea>
                    </div>
                    <div class="card-content blue lighten-5">
                        <textarea type="text" class="flash-answer"  name="answer">green</textarea>
                    </div>
                    <div class="card-action">
                        <button class="btn z-depth-0"><i class="material-icons left">save</i>Save</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col s12 l6">
        <form class="h-100">
            <fieldset class="h-100">
                <div class="card card-flash hoverable">
                    <div class="card-content blue white-text lighten-1">
                        <textarea type="text" class="flash-question white-text" name="question">What's my favorite color?</textarea>
                    </div>
                    <div class="card-content blue lighten-5">
                        <textarea type="text" class="flash-answer"  name="answer">green</textarea>
                    </div>
                    <div class="card-action hide">
                        <button class="btn z-depth-0"><i class="material-icons left">save</i>Save</button>
                    </div>
                    <div class="progress m-0">
                        <div class="indeterminate"></div>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<script>
    (($,M) => {
        /**
         * <textarea> height control. Adapted from the below stackoverflow thread.
         * @see https://stackoverflow.com/questions/2803880/is-there-a-way-to-get-a-textarea-to-stretch-to-fit-its-content-without-using-php
         */
        const setHeight = el => {
            el.style.height = "";
            el.style.height = el.scrollHeight + "px";
        }
        const enableSave = form => {
            if( form.dataset.saveEnabled !== "1" ) {
                form.dataset.saveEnabled = "1";
                $(form).find('.card-action').removeClass('hide');
            }
        }
        const disableSave = form => {
            if( form.dataset.saveEnabled === "1" ) {
                form.dataset.saveEnabled = false;
                $(form).find('.card-action').addClass('hide');
            }
        }
        $("#flashcards")
            // Set the height of textarea's on input change
            .on("input", 'textarea', e => {
                setHeight(e.currentTarget);
                enableSave(e.currentTarget.form);
            })
            .on('submit','form', e => {
                e.preventDefault();

                // TODO complete form submit
                const form = $(e.currentTarget);
                const fieldset = form.find('fieldset');
                const card = form.find('.card');
                const fields = form.find('textarea');

                card.addClass('saving');
                fieldset.prop("disabled",true);

                // Reduce the list of fields to an object of data
                const data = [ ...fields ].reduce((data, field) => ({ ...data, [field.name]: field.value }), {});

                // Fake waiting for a response
                setTimeout(() => {

                    card.removeClass('saving');
                    disableSave(e.currentTarget);
                    fieldset.prop("disabled",false);

                    // Let the user know the save was a success
                    M.toast({ html: 'Flashcard saved!', classes: "green darken-2 white-text" })

                }, 2000);

            })
            // Set the height of textarea's on page load
            .find('textarea')
            .each(function() { setHeight(this); });
    })(jQuery,M)
</script>